# bot.py
import os
import logging
import random
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils import executor  # Оставь, если 2.x; для 3.x убери
from fastapi import FastAPI, Request  # Новое для webhook
import uvicorn  # Новое

# Токен через env для безопасности
API_TOKEN = os.getenv("TG_BOT_TOKEN") or "YOUR_TELEGRAM_BOT_TOKEN"  # Замени на свой, если тест локально
bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# Твои cells, SNAKES, LADDERS, players, get_keyboard, handlers (@dp.message_handler) — оставь как есть!

# Новый: FastAPI app для webhook
app = FastAPI()

@app.post('/webhook')  # Путь для Telegram обновлений
async def webhook(request: Request):
    update = types.Update(**await request.json())
    await dp.process_update(update)
    return {"ok": True}

# Убери if __name__ == "__main__": executor.start_polling... 

# Вместо него: Запуск сервера (для локального теста)
if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO)
    uvicorn.run(app, host="0.0.0.0", port=8000)  # Порт любой, но на PA будет авто
