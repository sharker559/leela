# bot.py
import os
import logging
import random
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils import executor  # –û—Å—Ç–∞–≤—å, –µ—Å–ª–∏ 2.x; –¥–ª—è 3.x —É–±–µ—Ä–∏
from fastapi import FastAPI, Request  # –ù–æ–≤–æ–µ –¥–ª—è webhook
import uvicorn  # –ù–æ–≤–æ–µ

# –¢–æ–∫–µ–Ω —á–µ—Ä–µ–∑ env –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
API_TOKEN = os.getenv("TG_BOT_TOKEN") or "YOUR_TELEGRAM_BOT_TOKEN"  # –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π, –µ—Å–ª–∏ —Ç–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ
bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# –¢–≤–æ–∏ cells, SNAKES, LADDERS, players, get_keyboard, handlers (@dp.message_handler) ‚Äî –æ—Å—Ç–∞–≤—å –∫–∞–∫ –µ—Å—Ç—å!

# –ù–æ–≤—ã–π: FastAPI app –¥–ª—è webhook
app = FastAPI()

@app.post('/webhook')  # –ü—É—Ç—å –¥–ª—è Telegram –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
async def webhook(request: Request):
    update = types.Update(**await request.json())
    await dp.process_update(update)
    return {"ok": True}

# –£–±–µ—Ä–∏ if __name__ == "__main__": executor.start_polling... 

# –í–º–µ—Å—Ç–æ –Ω–µ–≥–æ: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞)
if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO)
    uvicorn.run(app, host="0.0.0.0", port=8000)  # –ü–æ—Ä—Ç –ª—é–±–æ–π, –Ω–æ –Ω–∞ PA –±—É–¥–µ—Ç –∞–≤—Ç–æ

# === –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–ª–µ—Ç–æ–∫ (–Ω–æ–º–µ—Ä: title, description) ===
cells = {
  1: { "title": "–†–æ–∂–¥–µ–Ω–∏–µ (–¥–∂–∞–Ω–º–∞)", "desc": "–í—Ö–æ–¥ –≤ –∫–∞—Ä–º–∏—á–µ—Å–∫—É—é –∏–≥—Ä—É; –Ω–∞—á–∞–ª–æ –ø—É—Ç–∏, –≥–¥–µ –∏–≥—Ä–æ–∫ –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è –∑–∞–∫–æ–Ω–∞–º –∫–∞—Ä–º—ã –∏ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ –ö–æ—Å–º–∏—á–µ—Å–∫–æ–º—É –°–æ–∑–Ω–∞–Ω–∏—é." },
  2: { "title": "–ú–∞–π—è", "desc": "–ò–ª–ª—é–∑–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, —Å–∫—Ä—ã–≤–∞—é—â–∞—è –µ–¥–∏–Ω—Å—Ç–≤–æ; –∏–≥—Ä–æ–∫ –æ—Å–æ–∑–Ω–∞—ë—Ç –∏–ª–ª—é–∑–æ—Ä–Ω–æ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –π–æ–≥—É." },
  3: { "title": "–ì–Ω–µ–≤ (–∫—Ä–æ–¥—Ö–∞)", "desc": "–†–µ–∞–∫—Ü–∏—è —ç–≥–æ –Ω–∞ –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç—ã–µ –∞—Å–ø–µ–∫—Ç—ã; –ª–∏—á–Ω—ã–π –≥–Ω–µ–≤ —Ä–∞–∑—Ä—É—à–∞–µ—Ç, –Ω–æ –±–µ–∑–ª–∏—á–Ω—ã–π –æ—á–∏—â–∞–µ—Ç –¥–ª—è –¥—É—Ö–æ–≤–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞." },
  4: { "title": "–ñ–∞–¥–Ω–æ—Å—Ç—å (–ª–æ–±—Ö–∞)", "desc": "–°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–º—É –∏–∑ –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏; –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ–º, –µ—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –¥—É—Ö–æ–≤–Ω–æ–µ." },
  5: { "title": "–§–∏–∑–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω (–±—Ö—É-–ª–æ–∫–∞)", "desc": "–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –º–∏—Ä, —Ñ–æ–∫—É—Å –Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–∏; –ø–µ—Ä–≤–∞—è —á–∞–∫—Ä–∞, –±–µ–∑ —Å—Ç—Ä–µ–ª –≤–≤–µ—Ä—Ö, –ø–æ–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ —Ä–µ—à–µ–Ω—ã." },
  6: { "title": "–ó–∞–±–ª—É–∂–¥–µ–Ω–∏–µ (–º–æ—Ö–∞)", "desc": "–ü—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫ –º–∏—Ä—É, –≤—ã–∑—ã–≤–∞—é—â–∞—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Ä–æ–∂–¥–µ–Ω–∏—è; –æ—Å–æ–∑–Ω–∞–Ω–∏–µ –∏–≥—Ä—ã –ø–æ–º–æ–≥–∞–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ." },
  7: { "title": "–¢—â–µ—Å–ª–∞–≤–∏–µ (–º–∞–¥–∞)", "desc": "–õ–æ–∂–Ω–∞—è –≥–æ—Ä–¥–æ—Å—Ç—å, –æ–ø—å—è–Ω—è—é—â–∞—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏; –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–∞–¥–µ–Ω–∏—é –∏ —É—Å–∏–ª–µ–Ω–∏—é —ç–≥–æ." },
  8: { "title": "–ê–ª—á–Ω–æ—Å—Ç—å (–º–∞—Ç—Å–∞—Ä–∞)", "desc": "–ñ–µ–ª–∞–Ω–∏–µ —á—É–∂–æ–≥–æ, —É—Å–∏–ª–∏–≤–∞—é—â–µ–µ –∑–∞–≤–∏—Å—Ç—å; —Ç—Ä–µ–±—É–µ—Ç –æ—á–∏—â–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π —á–∞–∫—Ä—ã." },
  9: { "title": "–ß—É–≤—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–ª–∞–Ω (–∫–∞–º–∞-–ª–æ–∫–∞)", "desc": "–ñ–µ–ª–∞–Ω–∏—è —Å–ª–∞–≤—ã –∏ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–π; –ø–µ—Ä–≤–∞—è —Å—Ç–∞–¥–∏—è —ç–≤–æ–ª—é—Ü–∏–∏, –≤–µ–¥—É—â–∞—è –∫ –æ—á–∏—â–µ–Ω–∏—é." },
  10: { "title": "–û—á–∏—â–µ–Ω–∏–µ (—Ç–∞–ø–∞)", "desc": "–ê—Å–∫–µ–∑–∞, –ø–æ–≤—ã—à–∞—é—â–∞—è –≤–∏–±—Ä–∞—Ü–∏–∏; –ø—Ä–∞–∫—Ç–∏–∫–∏, –∫–∞–∫ –º–µ–¥–∏—Ç–∞—Ü–∏—è, –ø–æ–º–æ–≥–∞—é—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ –Ω–µ–±–µ—Å–Ω–æ–º—É –ø–ª–∞–Ω—É." },
  11: { "title": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è (–≥–∞–Ω–¥—Ö–∞—Ä–≤—ã)", "desc": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–¥–æ—Å—Ç—å –∏ –≥–∞—Ä–º–æ–Ω–∏—è; –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –î—É—Ö–∞ —á–µ—Ä–µ–∑ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ." },
  12: { "title": "–ó–∞–≤–∏—Å—Ç—å (–∏—Ä–∞—Å—ä—è)", "desc": "–ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –∫ –∂–∞–¥–Ω–æ—Å—Ç–∏; —Ç—Ä–µ–±—É–µ—Ç –æ—á–∏—â–µ–Ω–∏—è –º—ã—à–ª–µ–Ω–∏—è." },
  13: { "title": "–ù–∏—á—Ç–æ–∂–Ω–æ—Å—Ç—å (–∞–Ω—Ç–∞—Ä–∏–∫—à–∞)", "desc": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø—É—Å—Ç–æ—Ç–∞ –∏ —Ç—Ä–µ–≤–æ–≥–∞; –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ç—Ä–µ–±—É—é—â–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏." },
  14: { "title": "–ê—Å—Ç—Ä–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω (–±—Ö—É–≤–∞—Ä-–ª–æ–∫–∞)", "desc": "–¢–æ–Ω–∫–∞—è –º–∞—Ç–µ—Ä–∏—è, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å —á—É–≤—Å—Ç–≤–∞–º–∏; —É—Ä–æ–≤–µ–Ω—å, –≥–¥–µ –∏–≥—Ä–æ–∫ –ø–æ–ø–æ–ª–Ω—è–µ—Ç —ç–Ω–µ—Ä–≥–∏—é." },
  15: { "title": "–§–∞–Ω—Ç–∞–∑–∏—è (–∫–∞–ª—å–ø–∞–Ω–∞)", "desc": "–ú–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã, —Å–æ–∑–¥–∞—é—â–∏–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å; —Å–≤—è–∑–∞–Ω–∞ —Å–æ –≤—Ç–æ—Ä–æ–π —á–∞–∫—Ä–æ–π, —É—Å–∏–ª–∏–≤–∞–µ—Ç –∂–µ–ª–∞–Ω–∏—è." },
  16: { "title": "–ù–µ–±–µ—Å–Ω—ã–π –ø–ª–∞–Ω (—Å–≤–∞—Ä-–ª–æ–∫–∞)", "desc": "–†–∞–¥–æ—Å—Ç—å –∏ –≥–∞—Ä–º–æ–Ω–∏—è –ø–æ—Å–ª–µ –æ—á–∏—â–µ–Ω–∏—è; —É—Ä–æ–≤–µ–Ω—å, –≥–¥–µ –∏–≥—Ä–æ–∫ –Ω–∞—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ–∫–æ–π." },
  17: { "title": "–ü–ª–æ—Ö–∞—è –∫–æ–º–ø–∞–Ω–∏—è (–∫—É-—Å–∞–Ω–≥–∞)", "desc": "–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –≤–ª–∏—è–Ω–∏—è, –æ–ø—É—Å–∫–∞—é—â–∏–µ –≤–∏–±—Ä–∞—Ü–∏–∏; –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–∞–¥–µ–Ω–∏—é –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –∑–∞–≤–∏—Å—Ç–∏." },
  18: { "title": "–•–æ—Ä–æ—à–∞—è –∫–æ–º–ø–∞–Ω–∏—è (—Å—É-—Å–∞–Ω–≥–∞)", "desc": "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤—è–∑–∏, –ø–æ–¥–Ω–∏–º–∞—é—â–∏–µ –∫ –Ω–µ–±–µ—Å–Ω–æ–º—É –ø–ª–∞–Ω—É; —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –¥—É—Ö–æ–≤–Ω–æ–º—É —Ä–æ—Å—Ç—É." },
  19: { "title": "–ö–∞—Ä–º–∞ (–¥–µ–π—Å—Ç–≤–∏–µ)", "desc": "–¶–µ–ø–æ—á–∫–∞ —Å–æ–±—ã—Ç–∏–π, –∏–∑–º–µ–Ω—è–µ–º–∞—è –¥–µ–π—Å—Ç–≤–∏—è–º–∏; –æ—Å–æ–∑–Ω–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Å–≤–æ—é –∂–∏–∑–Ω—å." },
  20: { "title": "–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–∞–Ω–∞)", "desc": "–ë–µ—Å–∫–æ—Ä—ã—Å—Ç–Ω–æ–µ –æ—Ç–¥–∞–≤–∞–Ω–∏–µ; –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∫ –ø–ª–∞–Ω—É —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è, –±–∞–ª–∞–Ω—Å–∏—Ä—É—è –∂–∏–∑–Ω—å." },
  21: { "title": "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Å–∞–º–∞–Ω–∞ –ø–∞–ø–∞)", "desc": "–û—Å–æ–∑–Ω–∞–Ω–∏–µ –æ—à–∏–±–æ–∫; –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ä–º—É —á–µ—Ä–µ–∑ –æ—Å–æ–∑–Ω–∞–Ω–∏–µ." },
  22: { "title": "–î—Ö–∞—Ä–º–∞", "desc": "–ì–∞—Ä–º–æ–Ω–∏—è —Å –∑–∞–∫–æ–Ω–∞–º–∏ –±—ã—Ç–∏—è; –≤–µ–¥–µ—Ç –∫ –Ω–µ–±–µ—Å–Ω–æ–º—É –ø–ª–∞–Ω—É, —Ñ–æ–∫—É—Å –Ω–∞ –ø—Ä–∞–≤–µ–¥–Ω–æ—Å—Ç–∏." },
  23: { "title": "–ù–µ–±–µ—Å–Ω—ã–π –ø–ª–∞–Ω", "desc": "–í—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å –≥–∞—Ä–º–æ–Ω–∏–∏; —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –Ω–∏–∂–Ω–∏—Ö —á–∞–∫—Ä." },
  24: { "title": "–ö—É-—Å–∞–Ω–≥–∞ (–ø–ª–æ—Ö–∞—è –∫–æ–º–ø–∞–Ω–∏—è)", "desc": "–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –≤–ª–∏—è–Ω–∏—è; –ø–∞–¥–µ–Ω–∏–µ –∫ –∑–∞–≤–∏—Å—Ç–∏." },
  25: { "title": "–°—É-—Å–∞–Ω–≥–∞ (—Ö–æ—Ä–æ—à–∞—è –∫–æ–º–ø–∞–Ω–∏—è)", "desc": "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤—è–∑–∏; –ø–æ–¥—ä–µ–º –∫ –Ω–µ–±–µ—Å–Ω–æ–º—É –ø–ª–∞–Ω—É." },
  26: { "title": "–î—É–∫—Ö–∞ (–ø–µ—á–∞–ª—å)", "desc": "–°—Ç—Ä–∞–¥–∞–Ω–∏—è –æ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π; —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞." },
  27: { "title": "–ü–∞—Ä–∞–º –ê—Ä—Ç—Ö–∞ (–≤—ã—Å—à–∞—è —Ü–µ–ª—å)", "desc": "–û—Å–æ–∑–Ω–∞–Ω–∏–µ –≤—ã—Å—à–µ–≥–æ —Å–º—ã—Å–ª–∞; –≤–µ–¥–µ—Ç –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥—Ö–∞—Ä–º–µ." },
  28: { "title": "–°—É-–î—Ö–∞—Ä–º–∞ (–ø—Ä–∞–≤–µ–¥–Ω–æ—Å—Ç—å)", "desc": "–ì–∞—Ä–º–æ–Ω–∏—è —Å –∏—Å—Ç–∏–Ω–æ–π; –±–∞–ª–∞–Ω—Å –∂–∏–∑–Ω–∏." },
  29: { "title": "–ê-–î—Ö–∞—Ä–º–∞ (–Ω–µ–ø—Ä–∞–≤–µ–¥–Ω–æ—Å—Ç—å)", "desc": "–ù–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–≤; –ø–∞–¥–µ–Ω–∏–µ –∫ –ø–µ—á–∞–ª–∏." },
  30: { "title": "–£—Ç—Ç–∞–º–∞ –ì–∞—Ç–∏ (—Ö–æ—Ä–æ—à–∞—è —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è)", "desc": "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ; –ø–æ–¥—ä–µ–º –∫ –ø–ª–∞–Ω—É —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è." },
  31: { "title": "–Ø–∫—à–∞ –õ–æ–∫–∞ (–ø–ª–∞–Ω –¥–µ–º–æ–Ω–æ–≤)", "desc": "–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –∂–µ–ª–∞–Ω–∏—è; –ø–∞–¥–µ–Ω–∏–µ –∫ –ø–ª–æ—Ö–æ–π –∫–æ–º–ø–∞–Ω–∏–∏." },
  32: { "title": "–ü–ª–∞–Ω —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è", "desc": "–ë–∞–ª–∞–Ω—Å —ç–Ω–µ—Ä–≥–∏–π; —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–∞—Ä–º–æ–Ω–∏–∏." },
  33: { "title": "–ì–∞–Ω–¥—Ö–∞ –õ–æ–∫–∞ (–ø–ª–∞–Ω –∞—Ä–æ–º–∞—Ç–æ–≤)", "desc": "–ß–∏—Å—Ç–æ—Ç–∞ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è; —Å–≤—è–∑–∞–Ω–∞ —Å –∑–µ–º–ª–µ–π." },
  34: { "title": "–†–∞—Å–∞ –õ–æ–∫–∞ (–ø–ª–∞–Ω –≤–∫—É—Å–æ–≤)", "desc": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–∞—Ä–º–æ–Ω–∏—è; —Å–≤—è–∑–∞–Ω–∞ —Å –≤–æ–¥–æ–π." },
  35: { "title": "–ù–∞—Ä–∞–∫–∞ –õ–æ–∫–∞ (–∞–¥)", "desc": "–°—Ç—Ä–∞–¥–∞–Ω–∏—è –æ—Ç –Ω–µ–≥–∞—Ç–∏–≤–∞; –ø–∞–¥–µ–Ω–∏–µ –∫ –Ω–∏—á—Ç–æ–∂–Ω–æ—Å—Ç–∏." },
  36: { "title": "–°–≤–∞—á—á–∞ (—á–∏—Å—Ç–æ—Ç–∞)", "desc": "–û—á–∏—â–µ–Ω–∏–µ; –ø–æ–¥—ä–µ–º –∫ –º—É–¥—Ä–æ—Å—Ç–∏." },
  37: { "title": "–î–∂–Ω—è–Ω–∞ (–º—É–¥—Ä–æ—Å—Ç—å)", "desc": "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–≤; –ø–æ–¥—ä–µ–º –∫ –ø–ª–∞–Ω—É –±–ª–∞–∂–µ–Ω—Å—Ç–≤–∞." },
  38: { "title": "–ü—Ä–∞–Ω–∞ (—ç–Ω–µ—Ä–≥–∏—è)", "desc": "–ñ–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞; –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–ª–∞." },
  39: { "title": "–ê–ø–∞–Ω–∞ (–æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ)", "desc": "–û—á–∏—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ." },
  40: { "title": "–í—å—è–Ω–∞ (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)", "desc": "–ó–∞—â–∏—Ç–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è; –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–ª–∞." },
  41: { "title": "–î–∂–∞–Ω–∞ –õ–æ–∫–∞ (–ø–ª–∞–Ω –ª—é–¥–µ–π)", "desc": "–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ; —Ñ–æ–∫—É—Å –Ω–∞ —Ä–∞–∑—É–º–µ." },
  42: { "title": "–ê–≥–Ω–∏ –õ–æ–∫–∞ (–ø–ª–∞–Ω –æ–≥–Ω—è)", "desc": "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è; –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–æ–∂–¥–µ–Ω–∏—é." },
  43: { "title": "–†–æ–∂–¥–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞", "desc": "–û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ —Ä–æ–∂–¥–µ–Ω–∏–µ; —Å–≤–æ–±–æ–¥–∞ –æ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π." },
  44: { "title": "–ù–µ–≤–µ–¥–µ–Ω–∏–µ (–∞–≤–∏–¥—å—è)", "desc": "–ó–∞–±–≤–µ–Ω–∏–µ –∏—Å—Ç–∏–Ω—ã; –ø–∞–¥–µ–Ω–∏–µ –∫ –ø–µ—Ä–≤–æ–π —á–∞–∫—Ä–µ." },
  45: { "title": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ (—Å—É–≤–∏–¥—å—è)", "desc": "–û—Å–æ–∑–Ω–∞–Ω–∏–µ –µ–¥–∏–Ω—Å—Ç–≤–∞; –ø–æ–¥—ä–µ–º –∫ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–º—É –±–ª–∞–≥—É." },
  46: { "title": "–†–∞–∑–ª–∏—á–µ–Ω–∏–µ (–≤–∏–≤–µ–∫–∞)", "desc": "–û—Ç–ª–∏—á–µ–Ω–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ –æ—Ç –ª–æ–∂–Ω–æ–≥–æ; –ø–æ–¥—ä–µ–º –∫ –ø–ª–∞–Ω—É —Å—á–∞—Å—Ç—å—è." },
  47: { "title": "–°–∞—Ä–∞—Å–≤–∞—Ç–∏ (–ø–ª–∞–Ω –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç–∏)", "desc": "–†–∞–≤–Ω–æ–≤–µ—Å–∏–µ —ç–Ω–µ—Ä–≥–∏–π; —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª." },
  48: { "title": "–Ø–º—É–Ω–∞ (—Å–æ–ª–Ω–µ—á–Ω—ã–π –ø–ª–∞–Ω)", "desc": "–ú—É–∂—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è; –±–∞–ª–∞–Ω—Å —Å –∂–µ–Ω—Å–∫–∏–º." },
  49: { "title": "–ì–∞–Ω–≥–∞ (–ª—É–Ω–Ω—ã–π –ø–ª–∞–Ω)", "desc": "–ñ–µ–Ω—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è; –ø–∏—Ç–∞–Ω–∏–µ –∏ –≤–æ—Å–ø—Ä–∏–∏–º—á–∏–≤–æ—Å—Ç—å." },
  50: { "title": "–¢–∞–ø–∞ –õ–æ–∫–∞ (–ø–ª–∞–Ω –∞—Å–∫–µ–∑—ã)", "desc": "–î—É—Ö–æ–≤–Ω–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞; –æ—á–∏—â–µ–Ω–∏–µ." },
  51: { "title": "–ó–µ–º–ª—è (–ø—Ä–∏—Ç—Ö–≤–∏)", "desc": "–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω; –æ—Å–Ω–æ–≤–∞." },
  52: { "title": "–ù–∞—Å–∏–ª–∏–µ (—Ö–∏–º—Å–∞)", "desc": "–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è; –ø–∞–¥–µ–Ω–∏–µ –∫ –ø–µ—á–∞–ª–∏." },
  53: { "title": "–î–∂–∞–ª–∞ –õ–æ–∫–∞ (–ø–ª–∞–Ω –≤–æ–¥—ã)", "desc": "–¢–µ–∫—É—á–µ—Å—Ç—å –∏ –æ–±–º–µ–Ω; —Ü–∏–∫–ª –∂–∏–∑–Ω–∏." },
  54: { "title": "–ë—Ö–∞–∫—Ç–∏ (–¥—É—Ö–æ–≤–Ω–∞—è –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å)", "desc": "–õ—é–±–æ–≤—å –∫ –ë–æ–≥—É; –ø–æ–¥—ä–µ–º –∫ –ö–æ—Å–º–∏—á–µ—Å–∫–æ–º—É —Å–æ–∑–Ω–∞–Ω–∏—é." },
  55: { "title": "–ê—Ö–∞–º–∫–∞—Ä–∞ (—ç–≥–æ–∏–∑–º)", "desc": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã; —Ñ–æ–∫—É—Å –Ω–∞ –∂–µ–ª–∞–Ω–∏—è—Ö." },
  56: { "title": "–û–º–∫–∞—Ä–∞ (–∑–≤—É–∫)", "desc": "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è; —Å–∏–ª–∞ —Å–ª–æ–≤–∞." },
  57: { "title": "–í–∞–π—é –õ–æ–∫–∞ (–ø–ª–∞–Ω –≤–æ–∑–¥—É—Ö–∞)", "desc": "–õ–µ–≥–∫–æ—Å—Ç—å –∏ —Å–≤–æ–±–æ–¥–∞; –∏–Ω—Ç—É–∏—Ü–∏—è." },
  58: { "title": "–¢–µ–¥–∂–∞ –õ–æ–∫–∞ (—Å–∏—è–Ω–∏–µ)", "desc": "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–≤–µ—Ç; –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏–µ." },
  59: { "title": "–ü–ª–∞–Ω —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏", "desc": "–ü—Ä–∏–Ω—è—Ç–∏–µ –∏—Å—Ç–∏–Ω—ã; –±–µ–∑ –∏–ª–ª—é–∑–∏–π." },
  60: { "title": "–°—É-–ë—É–¥—Ö–∏ (–≤–µ—Ä–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ)", "desc": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—Å–ª–µ–π." },
  61: { "title": "–î—É—Ä-–ë—É–¥—Ö–∏ (–Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ)", "desc": "–ü—É—Ç–∞–Ω–∏—Ü–∞; –ø–∞–¥–µ–Ω–∏–µ –∫ –Ω–∏—á—Ç–æ–∂–Ω–æ—Å—Ç–∏." },
  62: { "title": "–°—É–∫—Ö–∞ (—Å—á–∞—Å—Ç—å–µ)", "desc": "–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ." },
  63: { "title": "–¢–∞–º–∞—Å (–∏–Ω–µ—Ä—Ü–∏—è)", "desc": "–õ–µ–Ω—å –∏ –∑–∞—Å—Ç–æ–π." },
  64: { "title": "–ü—Ä–∞–∫—Ä–∏—Ç–∏ –õ–æ–∫–∞ (–ø–ª–∞–Ω –ø—Ä–∏—Ä–æ–¥—ã)", "desc": "–ì–∞—Ä–º–æ–Ω–∏—è —Å –ø—Ä–∏—Ä–æ–¥–æ–π." },
  65: { "title": "–ê–Ω—Ç–∞—Ä–∏–∫—à–∞ –õ–æ–∫–∞ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ)", "desc": "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ—Å–º–æ—Å." },
  66: { "title": "–°–≤–∞—Ä –õ–æ–∫–∞ (–ø–ª–∞–Ω –Ω–µ–±–∞)", "desc": "–†–∞–¥–æ—Å—Ç—å –≤—ã—Å—à–µ–≥–æ." },
  67: { "title": "–ú–∞—Ö–∞—Ä –õ–æ–∫–∞ (–ø–ª–∞–Ω –≤–µ–ª–∏–∫–æ–≥–æ)", "desc": "–í–µ–ª–∏—á–∏–µ —Å–æ–∑–Ω–∞–Ω–∏—è." },
  68: { "title": "–ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ (–≤–∞–π–∫—É–Ω—Ç—Ö–∞)", "desc": "–¶–µ–ª—å –∏–≥—Ä—ã; –µ–¥–∏–Ω—Å—Ç–≤–æ —Å –ê–±—Å–æ–ª—é—Ç–æ–º." },
  69: { "title": "–†—É–¥—Ä–∞ –õ–æ–∫–∞ (–ø–ª–∞–Ω –†—É–¥—Ä—ã)", "desc": "–†–∞–∑—Ä—É—à–µ–Ω–∏–µ –∏–ª–ª—é–∑–∏–π." },
  70: { "title": "–°–∞—Ç—Ç–≤–∞ –ì—É–Ω–∞ (–≥—É–Ω–∞ –±–ª–∞–≥–æ—Å—Ç–∏)", "desc": "–ß–∏—Å—Ç–æ—Ç–∞ –∏ –≥–∞—Ä–º–æ–Ω–∏—è." },
  71: { "title": "–†–∞–¥–∂–∞—Å –ì—É–Ω–∞ (–≥—É–Ω–∞ —Å—Ç—Ä–∞—Å—Ç–∏)", "desc": "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –¥–µ–π—Å—Ç–≤–∏–µ." },
  72: { "title": "–¢–∞–º–∞—Å –ì—É–Ω–∞ (–≥—É–Ω–∞ –Ω–µ–≤–µ–∂–µ—Å—Ç–≤–∞)", "desc": "–¢—å–º–∞ –∏ –∏–Ω–µ—Ä—Ü–∏—è; –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ –∑–µ–º–ª–µ." }
}

# –ó–º–µ–∏ –∏ —Å—Ç—Ä–µ–ª—ã (–∫–∞–∫ –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å)
SNAKES = {72:51, 55:3, 52:35, 16:4, 63:2, 61:13, 44:9, 29:6, 24:7, 12:8}
LADDERS = {17:69, 22:60, 10:23, 27:41, 28:50, 45:67, 46:62, 54:68, 20:32, 37:66}

# –°–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ë–î)
players = {}  # user_id -> {"current": int, "history": list, "started": bool, "query": str}

def get_keyboard():
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add(KeyboardButton("üé≤ –ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫"))
    kb.add(KeyboardButton("üìú –ò—Å—Ç–æ—Ä–∏—è"))
    return kb

@dp.message_handler(commands=["start"])
async def cmd_start(message: types.Message):
    players[message.from_user.id] = {"current": 0, "history": [], "started": False, "query": ""}
    await message.answer("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ *–õ–∏–ª–∞ –ß–∞–∫—Ä–∞*! üôè\n\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã:", parse_mode="Markdown")

@dp.message_handler(lambda m: not players.get(m.from_user.id, {}).get("started"))
async def set_query(message: types.Message):
    user_id = message.from_user.id
    if user_id not in players:
        players[user_id] = {"current": 0, "history": [], "started": False, "query": ""}
    players[user_id]["query"] = message.text.strip()
    players[user_id]["started"] = True
    await message.answer(f"–ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç: *{message.text}* ‚úÖ\n\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –±—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫!", parse_mode="Markdown", reply_markup=get_keyboard())

@dp.message_handler(lambda m: m.text == "üé≤ –ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫")
async def roll_dice(message: types.Message):
    user_id = message.from_user.id
    if user_id not in players or not players[user_id]["started"]:
        await message.answer("–°–Ω–∞—á–∞–ª–∞ –Ω–∞—á–Ω–∏ –∏–≥—Ä—É –∫–æ–º–∞–Ω–¥–æ–π /start")
        return

    roll = random.randint(1,6)
    player = players[user_id]

    # –ø–µ—Ä–≤—ã–π –±—Ä–æ—Å–æ–∫: –ø–æ–∑–∏—Ü–∏—è = –≤—ã–ø–∞–≤—à–µ–µ —á–∏—Å–ª–æ
    if player["current"] == 0:
        new_cell = roll
    else:
        new_cell = player["current"] + roll

    text_parts = []
    text_parts.append(f"üé≤ –í—ã–ø–∞–ª–æ *{roll}*")

    # –æ—Ç—Å–∫–æ–∫ –≤—ã—à–µ 72
    if new_cell > 72:
        new_cell = 72 - (new_cell - 72)
        text_parts.append(f"‚Ü© –ü–µ—Ä–µ–±–æ—Ä –∑–∞ 72 ‚Äî –≤—ã –æ—Ç—Å–∫–æ—á–∏–ª–∏ –Ω–∞–∑–∞–¥ –Ω–∞ *{new_cell}*")

    # –∑–∞–ø–∏—Å—å –ø–æ—Å–µ—â–µ–Ω–∏—è
    player["current"] = new_cell
    player["history"].append(new_cell)

    cell_info = cells.get(new_cell, {"title":"–û–±—ã—á–Ω–∞—è –∫–ª–µ—Ç–∫–∞","desc":"–û–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ."})
    text_parts.append(f"–í—ã –ø–æ–ø–∞–ª–∏ –Ω–∞ –∫–ª–µ—Ç–∫—É *{new_cell}*: _{cell_info['title']}_\n{cell_info['desc']}")

    # –∑–º–µ–∏/—Å—Ç—Ä–µ–ª—ã
    if new_cell in SNAKES:
        final = SNAKES[new_cell]
        player["current"] = final
        player["history"].append(final)
        fin_info = cells.get(final, {"title":"–û–±—ã—á–Ω–∞—è –∫–ª–µ—Ç–∫–∞","desc":"–û–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ."})
        text_parts.append(f"üêç –ó–º–µ—è! –í—ã –±—ã–ª–∏ —É–∫—É—Å–µ–Ω—ã –∏ —Å–ø—É—Å—Ç–∏–ª–∏—Å—å –Ω–∞ *{final}*: _{fin_info['title']}_")
    elif new_cell in LADDERS:
        final = LADDERS[new_cell]
        player["current"] = final
        player["history"].append(final)
        fin_info = cells.get(final, {"title":"–û–±—ã—á–Ω–∞—è –∫–ª–µ—Ç–∫–∞","desc":"–û–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ."})
        text_parts.append(f"ü™ú –°—Ç—Ä–µ–ª–∞! –í—ã –ø–æ–¥–Ω—è–ª–∏—Å—å –Ω–∞ *{final}*: _{fin_info['title']}_")

    # –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è
    text_parts.append(f"_–ü–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –≤–∞—à–∏–º –∑–∞–ø—Ä–æ—Å–æ–º:_ \"*{player['query']}*\"")
    text_parts.append("_–í–æ–ø—Ä–æ—Å: –ü–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ –≤–∞—Å? –ß—Ç–æ –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –≥–æ–ª–æ–≤—É?_")

    result_text = "\n\n".join(text_parts)

    # –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –∫–ª–µ—Ç–∫–∏ 68 ‚Äî –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
    if player["current"] == 68:
        result_text += f"\n\nüéâ *–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!* –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ *–ö–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–Ω–∞–Ω–∏—è (–∫–ª–µ—Ç–∫–∞ 68)* ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: *{player['query']}*"
        # –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
        await message.answer(result_text, parse_mode="Markdown")
        return

    await message.answer(result_text, parse_mode="Markdown")

@dp.message_handler(lambda m: m.text == "üìú –ò—Å—Ç–æ—Ä–∏—è")
async def show_history(message: types.Message):
    user_id = message.from_user.id
    if user_id not in players or not players[user_id]["history"]:
        await message.answer("–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞.")
        return
    hist = players[user_id]["history"]
    lines = ["üìú *–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤:*"]
    # –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–ª–∏ –ø–æ–ª–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –∑–¥–µ—Å—å –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    for i,cell in enumerate(hist, start=1):
        info = cells.get(cell, {"title":"–û–±—ã—á–Ω–∞—è –∫–ª–µ—Ç–∫–∞"})
        lines.append(f"{i}. {cell} ‚Äî *{info['title']}*")
    await message.answer("\n".join(lines), parse_mode="Markdown")

if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)
